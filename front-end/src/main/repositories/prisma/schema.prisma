generator client {
  provider = "prisma-client-ts"
  output = "./generated"
  engineType = "client"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model ingredients {
  id                    BigInt                  @id @default(autoincrement())
  name                  String                  @unique(map: "name") @db.VarChar(255)
  kcal_per_100g         Decimal                 @default(0.00) @db.Decimal(8, 2)
  protein_g_per_100g    Decimal                 @default(0.00) @db.Decimal(8, 2)
  carbs_g_per_100g      Decimal                 @default(0.00) @db.Decimal(8, 2)
  fat_g_per_100g        Decimal                 @default(0.00) @db.Decimal(8, 2)
  created_at            DateTime                @default(now()) @db.Timestamp(0)
  ingredients_recette   ingredients_recette[]
  inventaire_ingredient inventaire_ingredient[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model ingredients_recette {
  recipe_id     BigInt
  ingredient_id BigInt
  qty_grams     Decimal     @db.Decimal(12, 3)
  notes         String?     @db.VarChar(255)
  ingredients   ingredients @relation(fields: [ingredient_id], references: [id], onUpdate: NoAction, map: "fk_ir_ing")
  recette       recette     @relation(fields: [recipe_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_ir_recipe")

  @@id([recipe_id, ingredient_id])
  @@index([ingredient_id], map: "fk_ir_ing")
}

model inventaire {
  id                    BigInt                  @id @default(autoincrement())
  user_id               BigInt                  @unique(map: "user_id")
  created_at            DateTime                @default(now()) @db.Timestamp(0)
  utilisateur           utilisateur             @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_inv_user")
  inventaire_ingredient inventaire_ingredient[]
}

model inventaire_ingredient {
  inventaire_id BigInt
  ingredient_id BigInt
  qty_grams     Decimal     @default(0.000) @db.Decimal(14, 3)
  ingredients   ingredients @relation(fields: [ingredient_id], references: [id], onUpdate: NoAction, map: "fk_ii_ing")
  inventaire    inventaire  @relation(fields: [inventaire_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_ii_inv")

  @@id([inventaire_id, ingredient_id])
  @@index([ingredient_id], map: "fk_ii_ing")
}

model journal {
  id             BigInt      @id @default(autoincrement())
  user_id        BigInt
  recipe_id      BigInt
  servings_eaten Decimal     @default(1.00) @db.Decimal(6, 2)
  logged_at      DateTime    @default(now()) @db.DateTime(0)
  kcal           Decimal     @db.Decimal(12, 2)
  protein_g      Decimal     @db.Decimal(12, 2)
  carbs_g        Decimal     @db.Decimal(12, 2)
  fat_g          Decimal     @db.Decimal(12, 2)
  recette        recette     @relation(fields: [recipe_id], references: [id], onUpdate: NoAction, map: "fk_j_recipe")
  utilisateur    utilisateur @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_j_user")

  @@index([recipe_id], map: "fk_j_recipe")
  @@index([user_id, logged_at], map: "k_journal_user_time")
}

model plansrepas {
  id                 BigInt               @id @default(autoincrement())
  user_id            BigInt
  week_start_date    DateTime             @db.Date
  created_at         DateTime             @default(now()) @db.Timestamp(0)
  utilisateur        utilisateur          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_plan_user")
  plansrepas_recette plansrepas_recette[]

  @@unique([user_id, week_start_date], map: "uq_user_week")
}

model plansrepas_recette {
  id               BigInt                       @id @default(autoincrement())
  plan_id          BigInt
  date             DateTime                     @db.Date
  meal_type        plansrepas_recette_meal_type
  recipe_id        BigInt
  planned_servings Decimal                      @default(1.00) @db.Decimal(6, 2)
  plansrepas       plansrepas                   @relation(fields: [plan_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_prr_plan")
  recette          recette                      @relation(fields: [recipe_id], references: [id], onUpdate: NoAction, map: "fk_prr_recipe")

  @@index([recipe_id], map: "fk_prr_recipe")
  @@index([plan_id, date, meal_type], map: "k_plan_day")
}

model recette {
  id                    BigInt                @id @default(autoincrement())
  user_id               BigInt?
  name                  String                @db.VarChar(255)
  servings              Decimal               @default(1.00) @db.Decimal(6, 2)
  kcal_per_serving      Decimal               @default(0.00) @db.Decimal(10, 2)
  protein_g_per_serving Decimal               @default(0.00) @db.Decimal(10, 2)
  carbs_g_per_serving   Decimal               @default(0.00) @db.Decimal(10, 2)
  fat_g_per_serving     Decimal               @default(0.00) @db.Decimal(10, 2)
  created_at            DateTime              @default(now()) @db.Timestamp(0)
  ingredients_recette   ingredients_recette[]
  journal               journal[]
  plansrepas_recette    plansrepas_recette[]
  utilisateur           utilisateur?          @relation(fields: [user_id], references: [id], onUpdate: NoAction, map: "fk_recette_user")
  repasenregistre       repasenregistre[]

  @@index([user_id], map: "fk_recette_user")
}

model repasenregistre {
  id               BigInt      @id @default(autoincrement())
  user_id          BigInt
  name             String      @db.VarChar(255)
  recipe_id        BigInt
  default_servings Decimal     @default(1.00) @db.Decimal(6, 2)
  created_at       DateTime    @default(now()) @db.Timestamp(0)
  recette          recette     @relation(fields: [recipe_id], references: [id], onUpdate: NoAction, map: "fk_rm_recipe")
  utilisateur      utilisateur @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_rm_user")

  @@index([recipe_id], map: "fk_rm_recipe")
  @@index([user_id], map: "fk_rm_user")
}

model utilisateur {
  id              BigInt            @id @default(autoincrement())
  email           String            @unique(map: "email") @db.VarChar(255)
  name            String            @db.VarChar(120)
  created_at      DateTime          @default(now()) @db.Timestamp(0)
  inventaire      inventaire?
  journal         journal[]
  plansrepas      plansrepas[]
  recette         recette[]
  repasenregistre repasenregistre[]
}

enum plansrepas_recette_meal_type {
  breakfast
  lunch
  dinner
  snack
}
